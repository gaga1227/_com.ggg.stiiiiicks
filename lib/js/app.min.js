window.App=function(t){var i=t||{};return i.data={game:{allSticksAligned:!1,sticksAligned:0,scrambleMoves:1},levels:{defaultLevel:0,0:{sticksCount:3,moveDeterRatio:.5}},msg:{connection_error:["Data Request Failed","Please make sure your device has a working connection and try again."],content_unavailable:["Content Unavailable","The content you requested is not available in this version of the app, please contact support."],offline:["No Connection Found","This app requires a working internet connection to work properly."]},init:function(){}},i}(window.App),window.App=function(t){var i=t||{};return window.Platform=function(){function t(t){return e.indexOf(t.toLowerCase())>-1}function i(t){return t in document.documentElement}var e=navigator.userAgent.toLowerCase();return this.iPhone=t("iPhone"),this.iPad=t("iPad"),this.iPod=t("iPod"),this.iOS=this.iPhone||this.iPad||this.iPod,this.android=t("android"),this.touchOS=i("ontouchstart"),this.chrome=e.indexOf("chrome")>-1,this.debugLog=function(){console.log("iPhone: "+this.iPhone),console.log("iPad: "+this.iPad),console.log("iPod: "+this.iPod),console.log("iOS: "+this.iOS),console.log("android: "+this.android),console.log("touchOS: "+this.touchOS)},this}(),window.Platform.iOS||window.Platform.android||(window.alert=function(t){console.log("window.alert: "+t)}),i.utils={addDeviceClass:function(){var t=Platform;$html=$("html:eq(0)"),$html.removeClass("no-js").addClass("js"),$html.addClass(t.touchOS?"touch":"no-touch"),t.iOS?($html.addClass("ios"),t.iPhone?$html.addClass("iphone"):t.iPod?$html.addClass("ipod"):t.iPad&&$html.addClass("ipad")):t.android&&$html.addClass("android")},checkConnection:function(){if(!navigator.connection)return!1;var t=navigator.connection.type;return t},popMsg:function(t){return!t||t.length<2?"Invalid title or message text":void(navigator.notification?navigator.notification.alert(t[1],function(){},t[0],t[2]?t[2]:"OK"):alert("["+t[0]+"]: "+t[1]))},reloadApp:function(){window.location=String(window.location).substr(0,String(window.location).indexOf("#"))},init:function(){this.addDeviceClass()}},i}(window.App),window.App=function(t){var i=t||{};return i.view={canvasData:null,sticksData:[],animSpeed:{norm:.25},cssAnimProps:{stickActive:{opacity:"1"},stickInactive:{opacity:"0.4"}},$gameCanvas:$("#gameCanvas"),$sticksLayer:$("#sticksLayer"),$bgAnimLayer:$("#bgAnimLayer"),$gridLayer:$("#gridLayer"),animateStickActive:function(t){TweenLite.to(t,this.animSpeed.norm,this.cssAnimProps.stickActive)},animateStickInactive:function(t){TweenLite.to(t,this.animSpeed.norm,this.cssAnimProps.stickInactive)},touchEvents:["touchstart.gameCanvas","touchmove.gameCanvas","touchend.gameCanvas","touchleave.gameCanvas","touchcancel.gameCanvas"],onTouchStart:function(t){this.updateSticksOnTouch(t),this.addBgAnimsOnTouch(t)},onTouchMove:function(t){this.updateSticksOnTouch(t),this.addBgAnimsOnTouch(t)},onTouchEnd:function(t){this.updateSticksOnTouch(t),this.addBgAnimsOnTouch(t)},updateSticksOnTouch:function(t){if("touchstart"===t.type)this.$activeStick=this.getTargetStick(t),this.animateStickActive(this.$activeStick[0]),this.$activeStick.siblings(".stick").each(_.bind(function(t,i){this.animateStickInactive(i)},this));else if("touchmove"===t.type){var i=this.$activeStick,e=this.getTargetStick(t);if(!i||!e)return!1;i.index()!==e.index()&&(this.$activeStick=e),this.animateStickActive(this.$activeStick[0]),this.$activeStick.siblings(".stick").each(_.bind(function(t,i){this.animateStickInactive(i)},this))}else this.$sticksLayer.find(".stick").each(_.bind(function(t,i){this.animateStickInactive(i)},this))},addBgAnimsOnTouch:function(t){if("touchstart"===t.type);else if("touchmove"===t.type)for(var i=t.originalEvent.touches[0].clientX-this.canvasData.offset.left,e=t.originalEvent.touches[0].clientY-this.canvasData.offset.top,n=1;n--;)this.addParticle(i,e)},addParticle:function(t,i){if(!_.isNumber(t)||!_.isNumber(i))return!1;var e=$("<div/>"),n={top:i+"px",left:t+"px",width:"0px",height:"0px",opacity:"0.2"};e.addClass("particle").css(n).appendTo(this.$bgAnimLayer);var s=60,a=55,o=(Math.random()*a+(s-a))*(Math.random()>.5?-1:1),c=Math.sqrt(Math.pow(s,2)-Math.pow(o,2))*(Math.random()>.5?-1:1),h=Math.round(t+o),d=Math.round(i+c),r=50,l=Math.round(.6*Math.random()*r);r+=l;var p={top:d+"px",left:h+"px",width:r+"px",height:r+"px",opacity:"0",onComplete:_.bind(function(){e.remove()},this)};TweenLite.to(e[0],.6,p)},initTouch:function(){this.$gameCanvas.off(this.touchEvents.join(" ")).on(this.touchEvents[0],_.bind(this.onTouchStart,this)).on(this.touchEvents[1],_.bind(this.onTouchMove,this)).on(this.touchEvents[2],_.bind(this.onTouchEnd,this)).on(this.touchEvents[3],_.bind(this.onTouchEnd,this)).on(this.touchEvents[4],_.bind(this.onTouchEnd,this))},initHammer:function(){this.hammer=new Hammer(this.$gameCanvas[0]),this.hammer.on("tap doubletap press swipe",_.bind(function(t){var i,e=t.center.x-this.canvasData.offset.left,n=t.center.y-this.canvasData.offset.top,s=this.canvasData.height/this.sticksData.length,a=Math.ceil(n/s);"tap"==t.type?i=e<this.canvasData.width/2?"left":"right":"swipe"==t.type&&(2==t.direction?i="left":4==t.direction&&(i="right")),"press"==t.type&&this.$gridLayer.toggleClass("debug"),this.calculateStickPositions(a,i),this.renderSticks(!0)},this))},toggleLoader:function(t){var i=$("#loader"),e="active";return i.length?void(t?i.addClass(e):i.removeClass(e)):"no loader elem found"},getTargetStick:function(t){for(var i,e=t.originalEvent.touches[0].clientY-this.canvasData.offset.top,n=this.sticksData.length,s=this.canvasData.height/n;n--;)if(e>s*n){i=n;break}return i>=0?this.sticksData[i].$el:!1},getCanvasData:function(){var t={width:this.$gameCanvas.width(),height:this.$gameCanvas.height(),offset:this.$gameCanvas.offset()};return t},getMaxMoveSegments:function(t){var i=Math.pow(1/t.moveDeterRatio,t.sticksCount);this.canvasData.movePositions=[];for(var e=0;i>=e;e++)this.canvasData.movePositions.push(Math.round(e*this.canvasData.width/i));return i},addSticks:function(t){if(_.isUndefined(t)||_.isNaN(t))return console.log("[view.addSticks]: invalid sticks count supplied!"),!1;for(var i=this.getCanvasData();t--;){var e=this.sticksData.length+1,n=$("<div/>");n.addClass("stick").attr("id","stick-"+e).css({width:"0px",height:"0px",top:Math.round(i.height/2)+"px",left:Math.round(i.width/2)+"px",opacity:"0"}),this.sticksData.push({$el:n,id:e})}},positionSticks:function(t,i,e){if(!this.sticksData||this.sticksData.length<1)return console.log("[view.positionSticks]: not enough sticks to position!"),!1;if((_.isUndefined(t)||_.isNaN(t))&&(t=1),!i){var n=e?e:Math.floor(Math.random()*this.canvasData.movePositions.length);_.forEach(this.sticksData,_.bind(function(t){t.pos!==n&&(t.pos=t.newpos=n)},this))}for(;t--;){var s=Math.ceil(Math.random()*this.sticksData.length),a=Math.random()<.5?"left":"right";this.calculateStickPositions(s,a,!0)}},calculateStickPositions:function(t,e,n){var s=i.data.levels[i.data.levels.defaultLevel],a=1/s.moveDeterRatio;console.groupCollapsed("[view.calculateStickPositions]"),console.log("primaryStickIndex: ",t),console.log("swipeDirection: ",e),_.forEach(this.sticksData,_.bind(function(i){i.deterLevel=Math.abs(i.id-t)+1;var n=this.maxMoveSegments/Math.pow(a,i.deterLevel);console.groupCollapsed("Stick: ",i.id),console.log("deterLevel: ",i.deterLevel),console.log("posShiftAmount: ",n),console.log("pos: ",i.pos),i.bounce=!1,"left"==e?(i.newpos=i.pos-n,i.newpos<0&&(i.bounce="left",i.newpos=Math.abs(i.newpos))):"right"==e&&(i.newpos=i.pos+n,i.newpos>this.maxMoveSegments&&(i.bounce="right",i.newpos=2*this.maxMoveSegments-i.newpos)),i.pos=i.newpos,console.log("newpos: ",i.pos),console.groupEnd()},this)),console.groupEnd(),n&&this.ifSticksAligned()&&this.calculateStickPositions(t,e,!0)},getSwipeDirection:function(t,i){var e,n=t>i,s=Math.abs(this.maxMoveSegments-t)>i;return e=t%i===0?0===t?"left":t==this.maxMoveSegments?"right":Math.random()<.5?"left":"right":n&&s?Math.random()<.5?"left":"right":n&&!s?"left":"right"},renderSticks:function(t){if(!this.sticksData||this.sticksData.length<1)return console.log("[view.renderSticks]: not enough sticks to render!"),!1;var i=this.$sticksLayer.find(".stick");_.forEach(this.sticksData,_.bind(function(e){var n=8,s=this.canvasData.height/this.sticksData.length,a=(e.id-1)*s,o=e.newpos;(_.isUndefined(o)||_.isNaN(o))&&(o=Math.floor(Math.random()*this.canvasData.movePositions.length)),e.pos!=o&&(e.pos=o);var c=this.canvasData.movePositions[o],h=-1*n/2;0===o&&(h=0),o==this.canvasData.movePositions.length-1&&(h=-1*n);var d=t?0:(e.id-1)*(.6/this.sticksData.length),r={width:n+"px",height:s+"px",top:a+"px",left:c+"px",marginLeft:h+"px",opacity:"0.4",delay:d};e.id==this.sticksData.length&&_.merge(r,{onComplete:_.bind(function(){t&&this.updateAlignedSticks()},this)});var l={width:n+"px",height:s+"px",top:a+"px",left:"0px",marginLeft:"0px"},p={width:n+"px",height:s+"px",top:a+"px",left:this.canvasData.movePositions[this.maxMoveSegments]+"px",marginLeft:-1*n+"px"};!t||"left"!=e.bounce&&"right"!=e.bounce?TweenLite.to(e.$el[0],this.animSpeed.norm,r):TweenLite.to(e.$el[0],this.animSpeed.norm/2,_.merge("left"==e.bounce?l:p,{onComplete:_.bind(function(){TweenLite.to(e.$el[0],this.animSpeed.norm/2,r)},this)})),e.id>i.length&&e.$el.appendTo(this.$sticksLayer)},this))},updateAlignedSticks:function(){i.data.game.allSticksAligned=this.ifSticksAligned(),i.data.game.allSticksAligned&&(i.data.game.sticksAligned+=this.sticksData.length,i.data.game.scrambleMoves=i.data.game.sticksAligned<30?1:i.data.game.sticksAligned<90?2:i.data.game.sticksAligned<180?3:i.data.game.sticksAligned<390?4:5,console.log("[Total Stiiiiicks Aligned]: ",i.data.game.sticksAligned),console.log("[scrambleMoves]: ",i.data.game.scrambleMoves),this.shrinkStick())},ifSticksAligned:function(){for(var t=1;t<this.sticksData.length;t++)if(this.sticksData[t].newpos!==this.sticksData[0].newpos)return!1;return!0},shrinkStick:function(t){if(t=_.isUndefined(t)?0:t,!this.sticksData[t].$el.length)return"[view.shrinkStick]: Invalid stick element!";var i=this.sticksData[t].$el[0],e={width:"8px",height:"0px",top:"0px",left:"50%",marginLeft:"-4px",onComplete:_.bind(function(){this.sticksData[t].shrunk=!0;var i={width:"8px",height:this.canvasData.height/this.sticksData.length+"px",top:this.canvasData.rowsPos[t]+"px",left:(t%2!==0?this.canvasData.width+50:-50)+"px",marginLeft:"0px",opacity:"0"};this.sticksData[t].$el.css(i),t==this.sticksData.length-1?this.resetSticks():this.shrinkStick(t+1)},this)};TweenLite.to(i,.6/this.sticksData.length,e)},resetSticks:function(){console.log("[view.resetSticks]"),this.positionSticks(i.data.game.scrambleMoves),this.renderSticks()},initGrids:function(){for(var t=this.maxMoveSegments,i=this.sticksData.length,e=this.canvasData.colsPos=[],n=this.canvasData.rowsPos=[],s=0;t>=s;s++)e.push(Math.round(this.canvasData.width/t*s));for(var a=0;i>=a;a++)n.push(Math.round(this.canvasData.height/i*a));this.$gridLayer.empty(),_.forEach(e,_.bind(function(t){if(0!==t&&t!==this.canvasData.width){var i=$("<div/>");i.attr("data-index",e.indexOf(t)).addClass("line vert").css({left:t+"px"}).appendTo(this.$gridLayer)}},this)),_.forEach(n,_.bind(function(t){if(0!==t&&t!==this.canvasData.height){var i=$("<div/>");i.addClass("line horz").css({top:t+"px"}).appendTo(this.$gridLayer)}},this))},updateGameCanvas:function(t,i){if(this.canvasData=this.getCanvasData(),this.maxMoveSegments=this.getMaxMoveSegments(t),this.initGrids(),i&&this.sticksData.length){var e=this.canvasData.height/this.sticksData.length;_.forEach(this.sticksData,_.bind(function(t){var i=(t.id-1)*e,n=this.canvasData.movePositions[t.newpos];t.$el.css({height:e+"px",top:i+"px",left:n+"px"})},this))}},initGame:function(t){this.addSticks(t.sticksCount),this.updateGameCanvas(t),$(window).on("resize.updateGameCanvas",_.bind(function(){this.updateGameCanvas(t,!0)},this)),this.positionSticks(),this.renderSticks(),this.initTouch(),this.initHammer()},init:function(){this.initGame(i.data.levels[i.data.levels.defaultLevel])}},i}(window.App),window.App=function(t){return App=t||{},App.name="StiiiiickS",App.version="0.0.1",App.lastUpdate="2015-02",App.onDeviceReady=function(){console.log("[device] e:deviceready")},App.onPause=function(){console.log("[device] e:pause")},App.onResume=function(){console.log("[device] e:resume")},App.onOnline=function(){console.log("[device] e:online")},App.onOffline=function(){console.log("[device] e:offline"),App.utils.popMsg(App.data.msg.offline)},App.onBackbutton=function(){console.log("[device] e:backbutton"),window.history.back()},App.onMenubutton=function(){console.log("[device] e:menubutton")},App.init=function(){return window.Platform.iOS||window.Platform.android?(console.log("running on iOS/Android"),App.onDevice=!0,document.addEventListener("deviceready",this.onDeviceReady,!1),document.addEventListener("pause",this.onPause,!1),document.addEventListener("resume",this.onResume,!1),document.addEventListener("online",this.onOnline,!1),document.addEventListener("offline",this.onOffline,!1),document.addEventListener("backbutton",this.onBackbutton,!1),document.addEventListener("menubutton",this.onMenubutton,!1)):(console.log("NOT running on iOS/Android"),App.onDevice=!1,this.onDeviceReady()),$?(App.utils.init(),App.view.init(),void App.data.init()):!1},App}(window.App),App.init();