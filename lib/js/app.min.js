window.App=function(t){var e=t||{};return e.data={game:{areAllSticksAligned:!1,totalMoves:0,totalAlignments:0,stiiiiicks:0,scrambleMoves:1},levels:{currentLevel:null,defaultLevel:1,0:{id:0,sticksCount:2,moveDeterRatio:.5},1:{id:1,sticksCount:3,moveDeterRatio:.5},2:{id:2,sticksCount:4,moveDeterRatio:.5},3:{id:3,sticksCount:5,moveDeterRatio:.5}},msg:{connection_error:["Data Request Failed","Please make sure your device has a working connection and try again."],content_unavailable:["Content Unavailable","The content you requested is not available in this version of the app, please contact support."],offline:["No Connection Found","This app requires a working internet connection to work properly."]},init:function(){}},e}(window.App),window.App=function(t){var e=t||{};return window.Platform=function(){function t(t){return i.indexOf(t.toLowerCase())>-1}function e(t){return t in document.documentElement}var i=navigator.userAgent.toLowerCase();return this.iPhone=t("iPhone"),this.iPad=t("iPad"),this.iPod=t("iPod"),this.iOS=this.iPhone||this.iPad||this.iPod,this.android=t("android"),this.touchOS=e("ontouchstart"),this.chrome=i.indexOf("chrome")>-1,this.debugLog=function(){console.log("iPhone: "+this.iPhone),console.log("iPad: "+this.iPad),console.log("iPod: "+this.iPod),console.log("iOS: "+this.iOS),console.log("android: "+this.android),console.log("touchOS: "+this.touchOS)},this}(),window.applicationCache&&window.applicationCache.addEventListener("updateready",function(){confirm("An update is available. Reload now?")&&window.location.reload()}),e.utils={addDeviceClass:function(){var t=Platform;$html=$("html:eq(0)"),$html.removeClass("no-js").addClass("js"),$html.addClass(t.touchOS?"touch":"no-touch"),t.iOS?($html.addClass("ios"),t.iPhone?$html.addClass("iphone"):t.iPod?$html.addClass("ipod"):t.iPad&&$html.addClass("ipad")):t.android&&$html.addClass("android")},noTouchBounce:function(t){var e=$(t?t:"body");e.off("touchmove.noTouchBounce").on("touchmove.noTouchBounce",function(t){t.preventDefault()})},loadTemplates:function(){var t=$('script[id|="template"]');if(t.length){var e={};return _.forEach(t,function(t){var i=$(t),a=i.attr("id").split("-")[1];tmplHtml=$.trim(i.html()),tmplHtml&&(e[a]=tmplHtml)}),e}},popMsg:function(t){if(!_.isPlainObject(t)||_.isUndefined(t.text))return"invalid message text!";if($("#message").length)return e.view.activeMsg?(e.view.messages.push(t),"[popMsg]: message modal active, putting into messages queue..."):"previous message not finished!";t.duration=_.isUndefined(t.duration)?1:t.duration;var i=$(e.view.templates.message),a=i.find(".overlay"),s=i.find(".modal"),n={scale:0,rotationX:90},o={css:{scale:1,rotationX:0},onComplete:_.bind(function(){0===t.duration?s.one("click",function(){TweenLite.to(a[0],e.view.animSpeed.msg/2,d),e.view.activeMsg=TweenLite.to(s[0],e.view.animSpeed.msg/2,c)}):(TweenLite.to(a[0],e.view.animSpeed.msg/2,d),e.view.activeMsg=TweenLite.to(s[0],e.view.animSpeed.msg/2,c))},this)},c={css:{scale:0,rotationX:-90},delay:t.duration,onComplete:_.bind(function(){"function"==typeof t.onComplete&&_.bind(t.onComplete,this)(),i.remove(),e.view.activeMsg=null,e.view.messages.length&&this.popMsg(e.view.messages.shift())},this)},h={opacity:0},l={opacity:1},d={opacity:0,delay:t.duration};i.find(".msgText").html(t.text),i.appendTo("body"),TweenLite.set(a[0],h),TweenLite.to(a[0],e.view.animSpeed.msg,l),TweenLite.set(s[0],n),e.view.activeMsg=TweenLite.to(s[0],e.view.animSpeed.msg,o)},init:function(){this.addDeviceClass()}},e}(window.App),window.App=function(t){var e=t||{};return e.view={canvasData:null,sticksData:[],activeMsg:null,messages:[],animSpeed:{norm:.25,msg:.5,scoreUp:.1,scoreDown:.8},gui:{$scoreText:$("#game .gui.top .title .text"),$scoreLabel:$("#game .gui.top .title .label"),levelClasses:["level0","level1","level2","level3"]},$game:$("#game"),$gameCanvas:$("#gameCanvas"),$sticksLayer:$("#sticksLayer"),$bgAnimLayer:$("#bgAnimLayer"),$gridLayer:$("#gridLayer"),$settings:$("#settings"),animateStickActive:function(t){TweenLite.to(t,this.animSpeed.norm,{opacity:"1"}),$(t).addClass("active")},animateStickInactive:function(t){TweenLite.to(t,this.animSpeed.norm,{opacity:"0.8"}),$(t).removeClass("active")},touchEvents:["touchstart.gameCanvas","touchmove.gameCanvas","touchend.gameCanvas","touchleave.gameCanvas","touchcancel.gameCanvas"],onTouchStart:function(t){this.updateSticksOnTouch(t)},onTouchMove:function(t){this.updateSticksOnTouch(t)},onTouchEnd:function(t){this.updateSticksOnTouch(t)},updateSticksOnTouch:function(t){if("touchstart"===t.type)this.$activeStick=this.getTargetStick(t),this.animateStickActive(this.$activeStick[0]),this.$activeStick.siblings(".stick").each(_.bind(function(t,e){this.animateStickInactive(e)},this));else if("touchmove"===t.type){var e=this.$activeStick,i=this.getTargetStick(t);if(!e||!i)return!1;e.index()!==i.index()&&(this.$activeStick=i),this.animateStickActive(this.$activeStick[0]),this.$activeStick.siblings(".stick").each(_.bind(function(t,e){this.animateStickInactive(e)},this))}else this.$sticksLayer.find(".stick").each(_.bind(function(t,e){this.animateStickInactive(e)},this))},addBgAnimsOnTouch:function(t){if("touchstart"===t.type);else if("touchmove"===t.type)for(var e=t.originalEvent.touches[0].clientX-this.canvasData.offset.left,i=t.originalEvent.touches[0].clientY-this.canvasData.offset.top,a=1;a--;)this.addParticle(e,i)},addParticle:function(t,e){if(!_.isNumber(t)||!_.isNumber(e))return!1;var i=$("<div/>"),a={top:e+"px",left:t+"px",width:"0px",height:"0px",opacity:"0.2"};i.addClass("particle").css(a).appendTo(this.$bgAnimLayer);var s=60,n=55,o=(Math.random()*n+(s-n))*(Math.random()>.5?-1:1),c=Math.sqrt(Math.pow(s,2)-Math.pow(o,2))*(Math.random()>.5?-1:1),h=Math.round(t+o),l=Math.round(e+c),d=50,r=Math.round(.6*Math.random()*d);d+=r;var u={top:l+"px",left:h+"px",width:d+"px",height:d+"px",opacity:"0",onComplete:_.bind(function(){i.remove()},this)};TweenLite.to(i[0],.6,u)},initTouch:function(){this.$gameCanvas.off(this.touchEvents.join(" ")).on(this.touchEvents[0],_.bind(this.onTouchStart,this)).on(this.touchEvents[1],_.bind(this.onTouchMove,this)).on(this.touchEvents[2],_.bind(this.onTouchEnd,this)).on(this.touchEvents[3],_.bind(this.onTouchEnd,this)).on(this.touchEvents[4],_.bind(this.onTouchEnd,this))},initHammer:function(){this.hammer&&(this.hammer.off("tap swipe"),this.hammer.destroy(),this.hammer=null),this.hammer=new Hammer(this.$gameCanvas[0]),this.hammer.on("tap swipe",_.bind(function(t){e.data.game.totalMoves++,e.data.game.stiiiiicks-=1,this.$game.trigger({type:"update.score",amount:-1});var i,a=t.center.x-this.canvasData.offset.left,s=t.center.y-this.canvasData.offset.top,n=this.canvasData.height/this.sticksData.length,o=Math.ceil(s/n);"tap"==t.type?i=a<this.canvasData.width/2?"left":"right":"swipe"==t.type&&(2==t.direction?i="left":4==t.direction&&(i="right")),this.calculateStickPositions(o,i),this.renderSticks(!0)},this))},getCanvasData:function(){var t={width:this.$gameCanvas.width(),height:this.$gameCanvas.height(),offset:this.$gameCanvas.offset()};return t},getMaxMoveSegments:function(t){var e=Math.pow(1/t.moveDeterRatio,t.sticksCount);this.canvasData.movePositions=[];for(var i=0;e>=i;i++)this.canvasData.movePositions.push(Math.round(i*this.canvasData.width/e));return e},getTargetStick:function(t){for(var e,i=t.originalEvent.touches[0].clientY-this.canvasData.offset.top,a=this.sticksData.length,s=this.canvasData.height/a;a--;)if(i>s*a){e=a;break}return e>=0?this.sticksData[e].$el:!1},getSwipeDirection:function(t,e){var i,a=t>e,s=Math.abs(this.maxMoveSegments-t)>e;return i=t%e===0?0===t?"left":t==this.maxMoveSegments?"right":Math.random()<.5?"left":"right":a&&s?Math.random()<.5?"left":"right":a&&!s?"left":"right"},addSticks:function(t){if(_.isUndefined(t)||_.isNaN(t))return console.log("[view.addSticks]: invalid sticks count supplied!"),!1;this.sticksData.length&&(this.sticksData=[]);for(var e=this.getCanvasData(),i=this.$sticksLayer.find(".stick");t--;){var a=this.sticksData.length+1,s=a<=i.length,n=$(s?i[a-1]:"<div/>");n.addClass("stick").attr("id","stick-"+a).css({width:"0px",height:"0px",top:Math.round(e.height/2)+"px",left:Math.round(e.width/2)+"px",opacity:"0"}),this.sticksData.push({$el:n,id:a})}},positionSticks:function(t,i){if(!this.sticksData||this.sticksData.length<1)return console.log("[view.positionSticks]: not enough sticks to position!"),!1;(_.isUndefined(t)||_.isNaN(t))&&(t=1);var a,s,n,o=0===e.data.game.totalAlignments||1===e.data.game.scrambleMoves;for(a=_.isNumber(i)?i:Math.floor(Math.random()*this.canvasData.movePositions.length),_.forEach(this.sticksData,_.bind(function(t){t.pos!==a&&(t.pos=t.newpos=a)},this));t--;)n=Math.ceil(Math.random()*this.sticksData.length),s=o?a>this.maxMoveSegments/2?"left":a<this.maxMoveSegments/2?"right":Math.random()<.5?"left":"right":Math.random()<.5?"left":"right",this.calculateStickPositions(n,s,!0)},calculateStickPositions:function(t,i,a){var s=e.data.levels[e.data.levels.defaultLevel],n=1/s.moveDeterRatio;console.groupCollapsed("[view.calculateStickPositions]"),console.log("primaryStickIndex: ",t),console.log("swipeDirection: ",i),_.forEach(this.sticksData,_.bind(function(e){e.deterLevel=Math.abs(e.id-t)+1;var a=this.maxMoveSegments/Math.pow(n,e.deterLevel);console.groupCollapsed("Stick: ",e.id),console.log("deterLevel: ",e.deterLevel),console.log("posShiftAmount: ",a),console.log("pos: ",e.pos),e.bounce=!1,"left"==i?(e.newpos=e.pos-a,e.newpos<0&&(e.bounce="left",e.newpos=Math.abs(e.newpos))):"right"==i&&(e.newpos=e.pos+a,e.newpos>this.maxMoveSegments&&(e.bounce="right",e.newpos=2*this.maxMoveSegments-e.newpos)),e.pos=e.newpos,console.log("newpos: ",e.pos),console.log("bounce: ",e.bounce),console.groupEnd()},this)),console.groupEnd(),a&&this.ifSticksAligned()&&this.calculateStickPositions(t,i,!0)},renderSticks:function(t){if(!this.sticksData||this.sticksData.length<1)return console.log("[view.renderSticks]: not enough sticks to render!"),!1;for(;this.$sticksLayer.find(".stick").length>this.sticksData.length;){var e=this.$sticksLayer.find(".stick").length-1,i=this.$sticksLayer.find(".stick")[e];i.remove()}var a=this.$sticksLayer.find(".stick");_.forEach(this.sticksData,_.bind(function(e){var i=8,s=this.canvasData.height/this.sticksData.length,n=(e.id-1)*s,o=e.newpos;(_.isUndefined(o)||_.isNaN(o))&&(o=Math.floor(Math.random()*this.canvasData.movePositions.length)),e.pos!=o&&(e.pos=o);var c=this.canvasData.movePositions[o],h=-1*i/2;0===o&&(h=0),o==this.canvasData.movePositions.length-1&&(h=-1*i);var l=t?0:(e.id-1)*(.6/this.sticksData.length),d={width:i+"px",height:s+"px",top:n+"px",left:c+"px",marginLeft:h+"px",opacity:"0.8",delay:l};e.id==this.sticksData.length&&_.merge(d,{onComplete:_.bind(function(){t&&this.updateAlignedSticks()},this)});var r={width:i+"px",height:s+"px",top:n+"px",left:"0px",marginLeft:"0px"},u={width:i+"px",height:s+"px",top:n+"px",left:this.canvasData.movePositions[this.maxMoveSegments]+"px",marginLeft:-1*i+"px"};!t||"left"!=e.bounce&&"right"!=e.bounce?TweenLite.to(e.$el[0],this.animSpeed.norm,d):TweenLite.to(e.$el[0],this.animSpeed.norm/2,_.merge("left"==e.bounce?r:u,{onComplete:_.bind(function(){TweenLite.to(e.$el[0],this.animSpeed.norm/2,d)},this)})),e.id>a.length&&e.$el.appendTo(this.$sticksLayer)},this))},resetSticks:function(){this.updateDifficulty(),console.log("[view.resetSticks]"),this.positionSticks(e.data.game.scrambleMoves),this.renderSticks()},shrinkStick:function(t){if(t=_.isUndefined(t)?0:t,!this.sticksData[t].$el.length)return"[view.shrinkStick]: Invalid stick element!";var i=this.sticksData[t].$el[0],a={width:"8px",height:"0px",top:"-30px",left:"50%",marginLeft:"-4px",onComplete:_.bind(function(){e.data.game.stiiiiicks+=e.data.game.scrambleMoves,this.$game.trigger({type:"update.score",amount:e.data.game.scrambleMoves}),this.sticksData[t].shrunk=!0;var i={width:"8px",height:this.canvasData.height/this.sticksData.length+"px",top:this.canvasData.rowsPos[t]+"px",left:(t%2!==0?this.canvasData.width+50:-50)+"px",marginLeft:"0px",opacity:"0"};this.sticksData[t].$el.css(i),t==this.sticksData.length-1?(this.checkAlignBonus(),this.resetSticks()):this.shrinkStick(t+1)},this)};TweenLite.to(i,.6/this.sticksData.length,a)},ifSticksAligned:function(){for(var t=1;t<this.sticksData.length;t++)if(this.sticksData[t].newpos!==this.sticksData[0].newpos)return!1;return!0},updateAlignedSticks:function(){e.data.game.areAllSticksAligned=this.ifSticksAligned(),e.data.game.areAllSticksAligned&&(e.data.game.totalAlignments++,this.shrinkStick())},checkAlignBonus:function(){var t=!1,i=this.sticksData.length;_.forEach(this.sticksData,_.bind(function(e){e.bounce&&(t=!0)},this)),t&&(e.data.game.stiiiiicks+=i,this.$game.trigger({type:"update.score",amount:i}),e.utils.popMsg({text:"Edge Bounce!<br><b>+"+i+"</b>"}),console.log("[checkAlignBonus]: bounceBonus",i))},updateDifficulty:function(){var t=e.data.game.scrambleMoves,i=null;1===e.data.game.totalAlignments?(e.data.game.scrambleMoves=1,e.utils.popMsg({text:"<b>Great</b><br>Start!"})):e.data.game.stiiiiicks<30&&e.data.game.scrambleMoves<=1?e.data.game.scrambleMoves=1:e.data.game.stiiiiicks<90&&e.data.game.scrambleMoves<=2?(e.data.game.scrambleMoves=2,i={text:"Too<br><b>Easy!</b>"}):e.data.game.stiiiiicks<180&&e.data.game.scrambleMoves<=3?(e.data.game.scrambleMoves=3,i={text:"Getting<br><b>Harder!</b>"}):e.data.game.stiiiiicks<390&&e.data.game.scrambleMoves<=4?(e.data.game.scrambleMoves=4,i={text:"Much More<br><b>Harder!</b>"}):e.data.game.scrambleMoves<=5&&(e.data.game.scrambleMoves=5,i={text:"You<br><b>Master!</b>"}),i&&e.data.game.scrambleMoves!==t&&e.utils.popMsg(i),console.log("[Total Moves]: ",e.data.game.totalMoves),console.log("[Total Alignments]: ",e.data.game.totalAlignments),console.log("[StiiiiickS]: ",e.data.game.stiiiiicks),console.log("[view.updateDifficulty]: scrambleMoves",e.data.game.scrambleMoves)},updateGameCanvas:function(t,e){if(this.canvasData=this.getCanvasData(),this.maxMoveSegments=this.getMaxMoveSegments(t),this.initGrids(!1,!0),e&&this.sticksData.length){var i=this.canvasData.height/this.sticksData.length;_.forEach(this.sticksData,_.bind(function(t){var e=(t.id-1)*i,a=this.canvasData.movePositions[t.newpos];t.$el.css({height:i+"px",top:e+"px",left:a+"px"})},this))}},initGameEvents:function(){$(window).off("resize.updateGameCanvas").on("resize.updateGameCanvas",_.bind(function(){this.updateGameCanvas(levelData,!0)},this)),this.$game.off("update.score").on("update.score",_.bind(function(){this.updateScoreText()},this))},initGame:function(t){e.data.levels.currentLevel=t.id,this.$game.removeClass(this.gui.levelClasses.join(" ")).addClass(this.gui.levelClasses[t.id]),this.gui.$scoreLabel.find(".count").text(new Array(t.sticksCount+1).join("i")),this.addSticks(t.sticksCount),this.updateGameCanvas(t),this.positionSticks(),this.renderSticks(),this.initTouch(),this.initHammer(),this.initGameEvents()},updateScoreText:function(){var t=this.gui.$scoreText,i=parseInt(t.text(),10),a={transform:"translate(0, -8px) scale(1.2)",ease:"easeIn",onComplete:_.bind(function(){TweenLite.to(t[0],this.animSpeed.scoreUp,{transform:"translate(0) scale(1)",ease:"easeIn"})},this)},s={transform:"translate(0, -60px) scale(0.6)",opacity:"0",ease:"Power3.easeOut",onComplete:_.bind(function(){n.remove()},this)};if(e.data.game.stiiiiicks!==i)if(t.text(e.data.game.stiiiiicks),e.data.game.stiiiiicks>i)TweenLite.to(t[0],this.animSpeed.scoreUp,a);else{var n=t.clone().addClass("clone").text("-1").insertAfter(t);TweenLite.to(n[0],this.animSpeed.scoreDown,s)}},initGrids:function(t,e){for(var i=this.maxMoveSegments,a=this.sticksData.length,s="123456789abcdefghijklmnopqrstuvwxyz".split(""),n=this.canvasData.colsPos=[],o=this.canvasData.rowsPos=[],c=0;i>=c;c++)n.push(Math.round(this.canvasData.width/i*c));for(var h=0;a>=h;h++)o.push(Math.round(this.canvasData.height/a*h));this.$gridLayer.empty(),e&&_.forEach(n,_.bind(function(t){if(0!==t&&t!==this.canvasData.width){var e=$("<div/>");e.attr("data-index",s[n.indexOf(t)-1]).addClass("line vert").css({left:t+"px"}).appendTo(this.$gridLayer)}},this)),t&&_.forEach(o,_.bind(function(t){if(0!==t&&t!==this.canvasData.height){var e=$("<div/>");e.addClass("line horz").css({top:t+"px"}).appendTo(this.$gridLayer)}},this))},initSettings:function(){this.$settings.find('.btnLevel[data-level="'+e.data.levels.defaultLevel+'"]').addClass("selected").siblings(".btnLevel").removeClass("selected"),$(document).off("touchstart.button",'[data-role="button"]').on("touchstart.button",'[data-role="button"]',function(){$(this).addClass("active")}).off("touchend.button",'[data-role="button"]').on("touchend.button",'[data-role="button"]',function(){$(this).removeClass("active")}),$(".btnSettings").off("click.button").on("click.button",_.bind(function(t){t.preventDefault(),$("#settings").toggleClass("active")},this)),$(".btnHints").off("click.button").on("click.button",_.bind(function(t){t.preventDefault(),$(t.target).toggleClass("selected"),this.$gridLayer.toggleClass("active"),$("#settings").removeClass("active")},this)),$(".btnLevel").off("click.button").on("click.button",_.bind(function(t){t.preventDefault();var i=$(t.target),a=i.data().level;i.addClass("selected").siblings(".btnLevel").removeClass("selected"),this.initGame(e.data.levels[a]),$("#settings").removeClass("active")},this))},init:function(){e.utils.noTouchBounce(document.body),this.templates=e.utils.loadTemplates(),this.initSettings(),this.initGame(e.data.levels[e.data.levels.defaultLevel])}},e}(window.App),window.App=function(t){return App=t||{},App.name="StiiiiickS",App.version="0.0.1",App.lastUpdate="2015-02",App.onDeviceReady=function(){console.log("[device] e:deviceready")},App.onPause=function(){console.log("[device] e:pause")},App.onResume=function(){console.log("[device] e:resume")},App.onOnline=function(){console.log("[device] e:online")},App.onOffline=function(){console.log("[device] e:offline"),App.utils.popMsg(App.data.msg.offline)},App.onBackbutton=function(){console.log("[device] e:backbutton"),window.history.back()},App.onMenubutton=function(){console.log("[device] e:menubutton")},App.init=function(){return window.Platform.iOS||window.Platform.android?(console.log("running on iOS/Android"),App.onDevice=!0,document.addEventListener("deviceready",this.onDeviceReady,!1),document.addEventListener("pause",this.onPause,!1),document.addEventListener("resume",this.onResume,!1),document.addEventListener("online",this.onOnline,!1),document.addEventListener("offline",this.onOffline,!1),document.addEventListener("backbutton",this.onBackbutton,!1),document.addEventListener("menubutton",this.onMenubutton,!1)):(console.log("NOT running on iOS/Android"),App.onDevice=!1,this.onDeviceReady()),$?(App.utils.init(),App.data.init(),void App.view.init()):!1},App}(window.App),App.init();